function addLoadEvent(func){var oldonload=window.onload;if(typeof window.onload!="function"){window.onload=func;}else{window.onload=function(){oldonload();func();}}};function ajax(url,data,method,success,error){var req=new XMLHttpRequest(),data=data||{},method=method||"get",success=success||function(){},error=error||function(f){alert(url+"发生错误！")},resA="";req.onreadystatechange=function(){if(req.readyState==4){if(req.status>=200&&req.status<300||req.status==304||req.status==0){success&&success(req.responseText);}else{error&&error(req.status);}}};if(data){var resB=[];for(var i in data){resB.push(encodeURIComponent(i)+"="+encodeURIComponent(data[i]));}resA=resB.join("&");}if(method==="get"){if(data){url+="?"+resA;}req.open(method,url,true);req.send(null);}if(method=="post"){req.open(method,url,true);req.setRequestHeader("Content-type","application/x-www-form-urlencoded");req.send(resA);}}function addFuc(ele,event,listener){if(ele.addEventListener){ele.addEventListener(event,listener,false);}else if(ele.attachEvent){ele.attachEvent("on"+event,listener);}else{ele["on"+event]=listener;}}function hasClass(ele,className){var list=ele.className.split(/\s+/);for(var i=0;i<list.length;i++){if(list[i]==className){return true;}}return false;};function addClass(ele,className){var list=ele.className.split(/\s+/);if(!list[0]){ele.className=className;}else{ele.className+=" "+className;}};function removeClass(ele,className){var list=ele.className.split(/\s+/);if(!list[0])return;for(var i=0;i<list.length;i++){if(list[i]==className){list.splice(i,1);ele.className=list.join(" ");}}};function getElementsByClassName(element,names){if(element.getElementsByClassName){return element.getElementsByClassName(names);}else{var list=element.childNodes,new_list=[],len=list.length;for(var i=0;i<len;i++){if(list[i].nodeType==1&&list[i].getAttribute("class")){var arr=list[i].getAttribute("class").split(" "),names_arr=names.split(" "),count=0;for(var j=0;j<names_arr.length;j++){for(var n=0;n<arr.length;n++){if(names_arr[j]===arr[n]){count++;if(count==names_arr.length){new_list.push(list[i]);}}}}}}return new_list;}};function setCookie(name,value,days){var cookie=encodeURIComponent(name)+"="+encodeURIComponent(value),exp=new Date();exp.setTime(exp.getTime()+days*24*60*60*1000);cookie+=("; expires="+exp.toGMTString());document.cookie=cookie;}function getCookie(){var cookie={},all=document.cookie;if(all==="")return cookie;var list=all.split("; ");for(var i=0;i<list.length;i++){var item=list[i],p=item.indexOf("="),name=item.substring(0,p),value=item.substring(p+1);name=decodeURIComponent(name);value=decodeURIComponent(value);cookie[name]=value;}return cookie;}var document=window.document;function hideTip(){var tip=getElementsByClassName(document,"g-tip")[0];tip.style.display="none";};function closeTip(){var tipClose=getElementsByClassName(document,"t-close")[0];addFuc(tipClose,"click",function(){hideTip();setCookie("tipCookie","tipCookieValue",30);});};addLoadEvent(closeTip);function checkCookie(){if(getCookie().tipCookie){hideTip();}if(getCookie().loginSuc&&getCookie().followSuc){hideFollow();showFollowSuc();}};addFuc(window,"unbeforeunload",checkCookie());function logIn(){var follow=getElementsByClassName(document,"follow")[0];addFuc(follow,"click",function(){if(!getCookie().loginSuc){showLoginPop();var loginClose=getElementsByClassName(document,"l-close")[0];addFuc(loginClose,"click",function(){closeLoginPop();});var loginButton=getElementsByClassName(document,"l-btn")[0];addFuc(loginButton,"click",function(){if(validate()){ajax(url="http://study.163.com/webDev/login.htm",data={userName:userName,password:password},method="get",success=function(res){if(res==1){closeLoginPop();setCookie("loginSuc","loginSucValue",30);ajax(url="http://study.163.com/webDev/attention.htm",data={},method="get",success=function(res){if(res==1){hideFollow();showFollowSuc();setCookie("followSuc","followSucValue",30);}})}},error=function(){alert("登录错误，请重新登录")});}});}else{ajax(url="http://study.163.com/webDev/attention.htm",data={},method="get",success=function(){hideFollow();showFollowSuc();setCookie("followSuc","followSucValue",30);})}});function validate(){var userName=document.getElementsByName("userName")[0].value,password=document.getElementsByName("password")[0].value;if(userName==null||userName==""){alert("请输入用户名");}else{if(password==null||password==""){alert("请输入密码");}else{userName=hex_md5(userName);password=hex_md5(password);return true;}}}function showLoginPop(){getElementsByClassName(document,"g-mask")[0].style.display="block";getElementsByClassName(document,"g-login")[0].style.display="block";}function closeLoginPop(){getElementsByClassName(document,"g-mask")[0].style.display="none";getElementsByClassName(document,"g-login")[0].style.display="none";}function hideFollow(){getElementsByClassName(document,"follow")[0].style.display="none";}function showFollowSuc(){getElementsByClassName(document,"followSuc")[0].style.display="block";}};addLoadEvent(logIn);function circleImg(){var curControl=0,bannerArr=getElementsByClassName(document,"g-sld")[0].getElementsByTagName("li");bannerLen=bannerArr.length,controlArr=getElementsByClassName(document,"sldCtrol")[0].getElementsByTagName("i");var autoChange=setInterval(function(){if(curControl<(bannerLen-1)){curControl++;}else{curControl=0;}changeTo(curControl);},5000);addEvent();function addEvent(){for(var i=0;i<bannerLen;i++){(function(j){addFuc(controlArr[j],"click",function(){clearInterval(autoChange);changeTo(j);curControl=j;autoChange=setInterval(function(){if(curControl<(bannerLen-1)){curControl++;}else{curControl=0;}changeTo(curControl);},5000);});})(i);(function(j){addFuc(bannerArr[j],"mouseover",function(){clearInterval(autoChange);curControl=j;});addFuc(bannerArr[j],"mouseout",function(){autoChange=setInterval(function(){if(curControl<(bannerLen-1)){curControl++;}else{curControl=0;}changeTo(curControl);},5000);});})(i);}}function changeTo(num){var curBanner=getElementsByClassName(document,"sldOn")[0];fadeOut(curBanner);removeClass(curBanner,"sldOn");addClass(bannerArr[num],"sldOn");fadeIn(bannerArr[num]);var curControlOn=getElementsByClassName(document,"ctrolOn")[0];removeClass(curControlOn,"ctrolOn");addClass(controlArr[num],"ctrolOn");}function fadeIn(ele){setOpacity(ele,0);for(var i=0;i<=20;i++){(function(){var level=i*5;setTimeout(function(){setOpacity(ele,level);},i*25);})(i);}}function fadeOut(ele){for(var i=0;i<=20;i++){(function(){var level=100-i*5;setTimeout(function(){setOpacity(ele,level);},i*25);})(i);}}function setOpacity(ele,level){if(ele.filter){ele.style.filter="alpha(opacity='+level+')";}else{ele.style.opacity=level/100;}}}addLoadEvent(circleImg);function initCourse(pageNo,psize,ptype){var rootDom=getElementsByClassName(document,"course");function segment(opt){return'<li class="courseLi"><div class="img"><img src="'+opt.middlePhotoUrl+'" alt="课程中图" /></div><div class="title">'+opt.name+'</div><div class="orgName">'+opt.provider+'</div><span class="hot">'+opt.learnerCount+'</span><div class="discount">¥ <span>'+opt.price+'</span></div><div class="mDialog"><div class="uHead"><img src="'+opt.middlePhotoUrl+'" alt="课程中图" class="pic" /><div class="uInfo"><h3 class="uTit">'+opt.name+'</h3><div class="uHot"><span class="uNum">'+opt.learnerCount+'</span>人在学</div><div class="uPub">发布者：<span class="uOri">'+opt.provider+'</span></div><div class="uCategory">分类：<span class="uTag">'+opt.categoryName+'</span></div></div></div><div class="uIntro">'+opt.description+'</div></div></li>';}function courseRender(arr,num){var courseTemplate='';for(var i=0;i<num;i++){courseTemplate+=segment(arr[i]);}rootDom[0].innerHTML=courseTemplate;}ajax(url='http://study.163.com/webDev/couresByCategory.htm',data={pageNo:pageNo,psize:psize,type:ptype},method='get',success=function(res){var result=JSON.parse(res);courseRender(result.list,result.pagination.pageSize);pagination(result,courseRender,ptype,psize);showCourse();});}function pagination(data,render,courseType,size){var paginationDom=getElementsByClassName(document,"pagination")[0],paginationList=null,prevBtn=null,nextBtn=null,index=1;function reCourse(n){ajax(url='http://study.163.com/webDev/couresByCategory.htm',data={pageNo:n,psize:size,type:courseType},method='get',success=function(res){var result=JSON.parse(res);render(result.list,result.pagination.pageSize);showCourse();});for(var i=1;i<paginationList.length-1;i++){removeClass(paginationList[i],'on');}addClass(paginationList[n],'on');}paginationList=getElementsByClassName(document,'ele');prevBtn=paginationList[0];nextBtn=paginationList[paginationList.length-1];addClass(paginationList[1],'on');addFuc(prevBtn,"click",function(){if(index>1){reCourse(--index);}});addFuc(nextBtn,"click",function(){if(index<8){reCourse(++index);}});for(var i=1;i<paginationList.length-1;i++){paginationList[i].id=i;addFuc(paginationList[i],"click",function(){index=this.id;reCourse(this.id);});}}function showCourse(){var courseCell=getElementsByClassName(document,"courseLi");for(var i=0;i<courseCell.length;i++){addFuc(courseCell[i],"mouseover",function(){var dialog=getElementsByClassName(this,"mDialog")[0];dialog.style.display="block";});addFuc(courseCell[i],"mouseout",function(){var dialog=getElementsByClassName(this,"mDialog")[0];dialog.style.display="none";});}}function tabSwitch(size){var productBtn=getElementsByClassName(document,"lesson-tab")[0],programBtn=getElementsByClassName(document,"lesson-tab")[1],data=null;addFuc(productBtn,"click",function(){if(hasClass(programBtn,"crt")){removeClass(programBtn,"crt");addClass(productBtn,"crt");initCourse(1,size,10);}});addFuc(programBtn,"click",function(){if(hasClass(productBtn,"crt")){removeClass(productBtn,"crt");addClass(programBtn,"crt");initCourse(1,size,20);}});initCourse(1,size,10);}function mainContent(){var tag=null;if(document.body.clientWidth>=1205){tag=20;tabSwitch(20);}else{tag=15;tabSwitch(15);}addFuc(window,"resize",function(){if(document.body.clientWidth>=1205){tag=20;tabSwitch(20);}else{if(document.body.clientWidth<=1205){tag=15;tabSwitch(15);}}});}addLoadEvent(mainContent);function videoPlay(){var videoImg=getElementsByClassName(document,"videoImg")[0],videoClose=getElementsByClassName(document,"v-close")[0];addFuc(videoImg,"click",function(){showVideoPop();});addFuc(videoClose,"click",function(){hideVideoPop();});function showVideoPop(){getElementsByClassName(document,"g-mask")[0].style.display="block";getElementsByClassName(document,"showV")[0].style.display="block";}function hideVideoPop(){document.getElementsByTagName("video")[0].pause();getElementsByClassName(document,"g-mask")[0].style.display="none";getElementsByClassName(document,"showV")[0].style.display="none";}}addLoadEvent(videoPlay);function showHotList(){var returnData=null,elementLi="",num=0,elementUl=getElementsByClassName(document,"top-lst")[0];function createNode(opt){return'<img src="'+opt.smallPhotoUrl+'" alt="'+opt.name+'" class="hotListPic"><div><p class="hotListTitle">'+opt.name+'</p><span class="hotListUserCount">'+opt.learnerCount+'</span></div>';}ajax(url="http://study.163.com/webDev/hotcouresByCategory.htm",data={},method='get',success=function(res){returnData=JSON.parse(res);for(var i=0;i<10;i++){elementLi+='<li class="hotListLi">'+createNode(returnData[i])+'</li>';}elementUl.innerHTML=elementLi;});var updateCourse=setInterval(function func(){elementUl.removeChild(elementUl.childNodes[0]);var liNode=document.createElement("li");liNode.setAttribute("class","hotListLi");liNode.innerHTML=createNode(returnData[num]);elementUl.appendChild(liNode);num==19?num=0:num++;},5000);}addLoadEvent(showHotList);